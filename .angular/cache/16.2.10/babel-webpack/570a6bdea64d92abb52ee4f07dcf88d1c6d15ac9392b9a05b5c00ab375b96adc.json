{"ast":null,"code":"import _asyncToGenerator from \"C:/vivek/Angular/Stripe_demo/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { lastValueFrom } from 'rxjs';\nimport { StorageKey } from 'src/app/Services/storage/storage.service';\nimport { environment, stripeConfig } from 'src/app/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/Services/toastr-service/toastr-message.service\";\nimport * as i2 from \"src/app/Services/common/common.service\";\nimport * as i3 from \"ngx-spinner\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"src/app/Services/payment/payment.service\";\nimport * as i6 from \"src/app/Services/storage/storage.service\";\nimport * as i7 from \"src/app/Services/subscription/subscription.service\";\nimport * as i8 from \"@angular/common\";\nfunction PaymentComponent_div_41_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 30);\n    i0.ɵɵlistener(\"click\", function PaymentComponent_div_41_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.showCardList());\n    });\n    i0.ɵɵtext(1, \" Pay with existing card \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentComponent_div_41_div_3_ul_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ul\", 34)(1, \"li\", 35);\n    i0.ɵɵlistener(\"click\", function PaymentComponent_div_41_div_3_ul_1_Template_li_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const item_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r9.Addclass(item_r8.id));\n    });\n    i0.ɵɵelementStart(2, \"a\", 36)(3, \"div\", 37)(4, \"div\", 38);\n    i0.ɵɵelement(5, \"img\", 39)(6, \"input\", 40);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const item_r8 = ctx.$implicit;\n    const ctx_r7 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"id\", item_r8.id);\n    i0.ɵɵadvance(4);\n    i0.ɵɵpropertyInterpolate2(\"src\", \"\", ctx_r7.baseURL, \"\", item_r8.card.cardLogo, \"\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate1(\"placeholder\", \"**** **** **** \", item_r8.card.last4, \"\");\n  }\n}\nfunction PaymentComponent_div_41_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 31);\n    i0.ɵɵtemplate(1, PaymentComponent_div_41_div_3_ul_1_Template, 7, 4, \"ul\", 32);\n    i0.ɵɵelementStart(2, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function PaymentComponent_div_41_div_3_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.pay());\n    });\n    i0.ɵɵtext(3, \"Pay\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.cardList);\n  }\n}\nfunction PaymentComponent_div_41_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 41);\n    i0.ɵɵlistener(\"click\", function PaymentComponent_div_41_button_7_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r13.showCard());\n    });\n    i0.ɵɵtext(1, \" Pay with new card \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentComponent_div_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 24);\n    i0.ɵɵtemplate(2, PaymentComponent_div_41_button_2_Template, 2, 0, \"button\", 25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, PaymentComponent_div_41_div_3_Template, 4, 1, \"div\", 26);\n    i0.ɵɵelementStart(4, \"p\", 27);\n    i0.ɵɵtext(5, \"OR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 28);\n    i0.ɵɵtemplate(7, PaymentComponent_div_41_button_7_Template, 2, 0, \"button\", 29);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.showAddCard);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showAddCard);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showAddCard);\n  }\n}\nfunction PaymentComponent_div_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"form\", 43)(2, \"div\", 44)(3, \"div\", 45);\n    i0.ɵɵelement(4, \"div\", 46);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 47);\n    i0.ɵɵelement(6, \"div\", 48);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 47);\n    i0.ɵɵelement(8, \"div\", 49);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 45)(10, \"div\", 50);\n    i0.ɵɵelement(11, \"input\", 51);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(12, \"div\", 52)(13, \"div\", 53);\n    i0.ɵɵelementStart(14, \"button\", 54);\n    i0.ɵɵtext(15, \"Pay\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nconst stripe = Stripe(stripeConfig.publishKey);\nclass PaymentComponent {\n  constructor(toster, commonService, spinner, route, paymentService, storage, subscriptionService, router) {\n    this.toster = toster;\n    this.commonService = commonService;\n    this.spinner = spinner;\n    this.route = route;\n    this.paymentService = paymentService;\n    this.storage = storage;\n    this.subscriptionService = subscriptionService;\n    this.router = router;\n    this.PlanDetails = [];\n    this.cardList = [];\n    this.showAddCard = true;\n    this.baseURL = environment.BaseURL.replace(\"api/\", \"\");\n    this.todayDate = Date.now();\n  }\n  ngOnInit() {\n    this.GetStripeDetailsById();\n    this.spinner.show();\n    this.planId = this.commonService.Decrypt(this.route.snapshot.paramMap.get('id') ?? \"\");\n    this.GetSubscriptionPLanById();\n  }\n  GetStripeDetailsById() {\n    this.spinner.show();\n    const userId = this.commonService.Decrypt(this.storage.getValue(StorageKey.currentUserId));\n    this.subscriptionService.getStripeDetailsById(userId).then(data => {\n      if (data != null) {\n        this.stripeCustomerId = data.data.customerId;\n        this.endDate = data.data.endDate;\n        this.isActive = data.data.isActive;\n        this.cancaleDate = data.data.cancelDate;\n        if (this.stripeCustomerId == null) {\n          this.showAddCard = false;\n        }\n        this.GetSavedCardList();\n      } else {}\n    }).catch(error => {\n      this.spinner.hide();\n    });\n  }\n  LoadAndPay() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const result = _this.subscriptionService.InitiatePayment();\n      _this.PaymentSecrectKey = yield lastValueFrom(result);\n      var elements = new stripe.elements({\n        clientSecret: _this.PaymentSecrectKey.data.clientSecret,\n        fonts: [{\n          cssSrc: 'https://fonts.googleapis.com/css?family=Source+Code+Pro'\n        }]\n      });\n      var cardNumber = elements.create('cardNumber', {});\n      cardNumber.mount('#card-number-element');\n      var cardExpiry = elements.create('cardExpiry', {});\n      cardExpiry.mount('#card-cardExpiry-element');\n      var cardCvc = elements.create('cardCvc', {});\n      cardCvc.mount('#card-cardCvc-element');\n      document.querySelector(\"#payment-form\")?.addEventListener(\"submit\", /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (e) {\n          e.preventDefault();\n          _this.spinner.show();\n          stripe.handleCardSetup(_this.PaymentSecrectKey.data.clientSecret, cardNumber).then(result => {\n            if (result.setupIntent != undefined && result.setupIntent.status == \"succeeded\") {\n              _this.subscriptionModel = {\n                UserId: parseInt(_this.commonService.Decrypt(_this.storage.getValue('currentUserId'))),\n                PlanId: _this.planId,\n                PaymentMethodId: result.setupIntent.payment_method\n              };\n              if (_this.stripeCustomerId == null || !_this.isActive && _this.cancaleDate != null) {\n                _this.paymentService.InitializeCustomerSetupandSubscribe(_this.subscriptionModel).then(data => {\n                  _this.spinner.hide();\n                  if (data.success) {\n                    _this.commonService.setData(true);\n                    _this.router.navigate([\"match\"]);\n                    _this.toster.success(\"You have successfully subscribed \" + _this.PlanDetails.planName);\n                    _this.stripeCustomerId = data.data.customer;\n                  } else {\n                    _this.toster.error(data.message);\n                  }\n                }).catch(error => {\n                  _this.toster.error(error.error.message);\n                  _this.spinner.hide();\n                });\n              } else {\n                _this.subscriptionService.UpgradeSubscription(_this.subscriptionModel).then(data => {\n                  _this.spinner.hide();\n                  if (data && data.success) {\n                    _this.toster.success(data.message);\n                    _this.router.navigate([\"match\"]);\n                  } else {\n                    _this.toster.error(data.message);\n                  }\n                }).catch(error => {\n                  _this.toster.error(error.error.message);\n                  _this.spinner.hide();\n                });\n              }\n            } else {\n              _this.toster.error(result.error.message);\n              _this.spinner.hide();\n            }\n          });\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n  GetSubscriptionPLanById() {\n    this.paymentService.GetSubscriptionPlanById(this.planId).then(data => {\n      this.spinner.hide();\n      if (data && data.success) {\n        this.PlanDetails = data.data;\n      } else {\n        this.toster.error(data.message);\n      }\n    }).catch(error => {\n      this.spinner.hide();\n      this.toster.error(error.error.message);\n    });\n  }\n  GetSavedCardList() {\n    this.customerId = this.commonService.Decrypt(this.storage.getValue('currentUserId'));\n    if (this.customerId != 'null') {\n      this.spinner.show();\n      this.subscriptionService.GetCardDetails(this.customerId).then(data => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.cardList = data.data.data;\n        }\n        if (!this.showAddCard) {\n          this.LoadAndPay();\n        }\n      }).catch(error => {\n        this.spinner.hide();\n      });\n    }\n  }\n  goToBack() {\n    this.router.navigate([\"subscription\"]);\n  }\n  showCardList() {\n    this.showAddCard = true;\n  }\n  showCard() {\n    this.cardId = null;\n    this.showAddCard = false;\n    setTimeout(() => {\n      this.LoadAndPay();\n    }, 0);\n  }\n  Addclass(id) {\n    this.cardId = id;\n    document.querySelectorAll('.selected').forEach(e => {\n      e.classList.remove('selected');\n    });\n    document.getElementById(id)?.classList.add('selected');\n  }\n  pay() {\n    this.spinner.show();\n    this.subscriptionModel = {\n      UserId: parseInt(this.commonService.Decrypt(this.storage.getValue('currentUserId'))),\n      PlanId: this.planId,\n      PaymentMethodId: this.cardId\n    };\n    if (this.cardId == null) {\n      this.toster.error(\"Please select card\");\n      this.spinner.hide();\n      return;\n    }\n    if (this.stripeCustomerId == null || !this.isActive && this.cancaleDate != null) {\n      this.paymentService.InitializeCustomerSetupandSubscribe(this.subscriptionModel).then(data => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.commonService.setData(true);\n          this.router.navigate([\"match\"]);\n          this.toster.success(\"You have successfully subscribed \" + this.PlanDetails.planName);\n        } else {\n          this.toster.error(data.message);\n        }\n      }).catch(error => {\n        this.toster.error(error.error.message);\n        this.spinner.hide();\n      });\n    } else {\n      this.subscriptionService.UpgradeSubscription(this.subscriptionModel).then(data => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.toster.success(data.message);\n          this.router.navigate([\"match\"]);\n        } else {\n          this.toster.error(data.message);\n        }\n      }).catch(error => {\n        this.toster.error(error.error.message);\n        this.spinner.hide();\n      });\n    }\n  }\n  static #_ = this.ɵfac = function PaymentComponent_Factory(t) {\n    return new (t || PaymentComponent)(i0.ɵɵdirectiveInject(i1.ToastrMessageService), i0.ɵɵdirectiveInject(i2.CommonService), i0.ɵɵdirectiveInject(i3.NgxSpinnerService), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i5.PaymentService), i0.ɵɵdirectiveInject(i6.StorageService), i0.ɵɵdirectiveInject(i7.SubscriptionService), i0.ɵɵdirectiveInject(i4.Router));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PaymentComponent,\n    selectors: [[\"app-payment\"]],\n    decls: 43,\n    vars: 9,\n    consts: [[1, \"main-innerpage\", \"w-100\", \"float-start\"], [1, \"container\"], [1, \"innerpages\"], [1, \"font-color-pink\"], [1, \"w-100\", \"float-start\", \"payment_main\"], [1, \"payment_main_inner\"], [1, \"plan_section\"], [1, \"header\"], [1, \"header_link\", 3, \"click\"], [\"focusable\", \"false\", \"width\", \"12\", \"height\", \"12\", \"viewBox\", \"0 0 16 16\", 1, \"icon\"], [\"d\", \"M3.417 7H15a1 1 0 0 1 0 2H3.417l4.591 4.591a1 1 0 0 1-1.415 1.416l-6.3-6.3a1 1 0 0 1 0-1.414l6.3-6.3A1 1 0 0 1 8.008 2.41z\", \"fill-rule\", \"evenodd\"], [1, \"plan_summry\"], [1, \"plan_inner\"], [1, \"plan_list\"], [1, \"selected_plan\"], [\"src\", \"../assets/images/Logo-Dating.png\", 1, \"logo\"], [1, \"text\"], [1, \"plan_name\"], [1, \"badge\"], [1, \"small\"], [1, \"price\"], [1, \"stripe_section\"], [4, \"ngIf\"], [\"class\", \"formdata mt-3 w-100\", 4, \"ngIf\"], [1, \"text-center\"], [\"class\", \"main-btn add_card_btn text-center\", \"title\", \"Make Payment\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"w-100\", 4, \"ngIf\"], [1, \"or_devider\"], [1, \"add_card_main\", \"text-center\"], [\"class\", \"main-btn add_card_btn text-center\", \"title\", \"Add New Card\", 3, \"click\", 4, \"ngIf\"], [\"title\", \"Make Payment\", 1, \"main-btn\", \"add_card_btn\", \"text-center\", 3, \"click\"], [1, \"w-100\"], [\"class\", \"card_list mt-3\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"payment-submit\", 3, \"click\"], [1, \"card_list\", \"mt-3\"], [3, \"id\", \"click\"], [\"href\", \"javascript:;\"], [1, \"row\", \"card_details_main\"], [1, \"card_details\"], [1, \"img-fluid\", 3, \"src\"], [\"disabled\", \"\", \"type\", \"text\", 3, \"placeholder\"], [\"title\", \"Add New Card\", 1, \"main-btn\", \"add_card_btn\", \"text-center\", 3, \"click\"], [1, \"formdata\", \"mt-3\", \"w-100\"], [\"id\", \"payment-form\", 1, \"mt-5\"], [1, \"row\"], [1, \"col-md-12\", \"mb-2\"], [\"id\", \"card-number-element\", 1, \"form-control\"], [1, \"col-md-6\", \"mb-2\"], [\"id\", \"card-cardExpiry-element\", 1, \"form-control\"], [\"id\", \"card-cardCvc-element\", 1, \"form-control\"], [\"id\", \"card-zip-element\", 1, \"form-control\"], [\"type\", \"number\", \"placeholder\", \"12345\", \"maxlength\", \"5\"], [\"id\", \"error-messages\"], [\"id\", \"pay-button\"], [\"type\", \"submit\", \"id\", \"btnSubmit\", 1, \"payment-submit\"]],\n    template: function PaymentComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h2\");\n        i0.ɵɵtext(4, \"Proceed to payment\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"span\");\n        i0.ɵɵtext(6, \"Home > \");\n        i0.ɵɵelementStart(7, \"span\", 3);\n        i0.ɵɵtext(8, \"Proceed to payment\");\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(9, \"div\", 4)(10, \"div\", 1)(11, \"div\", 5)(12, \"div\", 6)(13, \"div\", 7)(14, \"a\", 8);\n        i0.ɵɵlistener(\"click\", function PaymentComponent_Template_a_click_14_listener() {\n          return ctx.goToBack();\n        });\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(15, \"svg\", 9);\n        i0.ɵɵelement(16, \"path\", 10);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelementStart(17, \"div\", 11)(18, \"h5\");\n        i0.ɵɵtext(19);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"div\", 12)(21, \"label\");\n        i0.ɵɵtext(22);\n        i0.ɵɵelementStart(23, \"span\");\n        i0.ɵɵtext(24, \"per\");\n        i0.ɵɵelement(25, \"br\");\n        i0.ɵɵtext(26);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(27, \"div\", 13)(28, \"div\", 14);\n        i0.ɵɵelement(29, \"img\", 15);\n        i0.ɵɵelementStart(30, \"div\", 16)(31, \"div\", 17)(32, \"label\");\n        i0.ɵɵtext(33);\n        i0.ɵɵelement(34, \"span\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"label\", 19);\n        i0.ɵɵtext(36);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(37, \"div\")(38, \"h6\", 20);\n        i0.ɵɵtext(39);\n        i0.ɵɵelementEnd()()()()()();\n        i0.ɵɵelementStart(40, \"div\", 21);\n        i0.ɵɵtemplate(41, PaymentComponent_div_41_Template, 8, 3, \"div\", 22);\n        i0.ɵɵtemplate(42, PaymentComponent_div_42_Template, 16, 0, \"div\", 23);\n        i0.ɵɵelementEnd()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(19);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.planName);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.charges);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate2(\"\", ctx.PlanDetails.intervalCount, \" \", ctx.PlanDetails.interval, \"\");\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate1(\"\", ctx.PlanDetails.planName, \" \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.planDescription);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.charges);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.stripeCustomerId != null);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.showAddCard);\n      }\n    },\n    dependencies: [i8.NgForOf, i8.NgIf],\n    styles: [\".stripe_section[_ngcontent-%COMP%]   .card_details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{\\n    width: 45px;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9QYWdlcy9wYXltZW50L3BheW1lbnQuY29tcG9uZW50LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtJQUNJLFdBQVc7QUFDZiIsInNvdXJjZXNDb250ZW50IjpbIi5zdHJpcGVfc2VjdGlvbiAuY2FyZF9kZXRhaWxzIGltZ3tcclxuICAgIHdpZHRoOiA0NXB4O1xyXG59Il0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}\nexport { PaymentComponent };","map":{"version":3,"names":["lastValueFrom","StorageKey","environment","stripeConfig","i0","ɵɵelementStart","ɵɵlistener","PaymentComponent_div_41_button_2_Template_button_click_0_listener","ɵɵrestoreView","_r6","ctx_r5","ɵɵnextContext","ɵɵresetView","showCardList","ɵɵtext","ɵɵelementEnd","PaymentComponent_div_41_div_3_ul_1_Template_li_click_1_listener","restoredCtx","_r10","item_r8","$implicit","ctx_r9","Addclass","id","ɵɵelement","ɵɵadvance","ɵɵpropertyInterpolate","ɵɵpropertyInterpolate2","ctx_r7","baseURL","card","cardLogo","ɵɵsanitizeUrl","ɵɵpropertyInterpolate1","last4","ɵɵtemplate","PaymentComponent_div_41_div_3_ul_1_Template","PaymentComponent_div_41_div_3_Template_button_click_2_listener","_r12","ctx_r11","pay","ɵɵproperty","ctx_r3","cardList","PaymentComponent_div_41_button_7_Template_button_click_0_listener","_r14","ctx_r13","showCard","PaymentComponent_div_41_button_2_Template","PaymentComponent_div_41_div_3_Template","PaymentComponent_div_41_button_7_Template","ctx_r0","showAddCard","stripe","Stripe","publishKey","PaymentComponent","constructor","toster","commonService","spinner","route","paymentService","storage","subscriptionService","router","PlanDetails","BaseURL","replace","todayDate","Date","now","ngOnInit","GetStripeDetailsById","show","planId","Decrypt","snapshot","paramMap","get","GetSubscriptionPLanById","userId","getValue","currentUserId","getStripeDetailsById","then","data","stripeCustomerId","customerId","endDate","isActive","cancaleDate","cancelDate","GetSavedCardList","catch","error","hide","LoadAndPay","_this","_asyncToGenerator","result","InitiatePayment","PaymentSecrectKey","elements","clientSecret","fonts","cssSrc","cardNumber","create","mount","cardExpiry","cardCvc","document","querySelector","addEventListener","_ref","e","preventDefault","handleCardSetup","setupIntent","undefined","status","subscriptionModel","UserId","parseInt","PlanId","PaymentMethodId","payment_method","InitializeCustomerSetupandSubscribe","success","setData","navigate","planName","customer","message","UpgradeSubscription","_x","apply","arguments","GetSubscriptionPlanById","GetCardDetails","goToBack","cardId","setTimeout","querySelectorAll","forEach","classList","remove","getElementById","add","_","ɵɵdirectiveInject","i1","ToastrMessageService","i2","CommonService","i3","NgxSpinnerService","i4","ActivatedRoute","i5","PaymentService","i6","StorageService","i7","SubscriptionService","Router","_2","selectors","decls","vars","consts","template","PaymentComponent_Template","rf","ctx","PaymentComponent_Template_a_click_14_listener","ɵɵnamespaceSVG","ɵɵnamespaceHTML","PaymentComponent_div_41_Template","PaymentComponent_div_42_Template","ɵɵtextInterpolate","charges","ɵɵtextInterpolate2","intervalCount","interval","ɵɵtextInterpolate1","planDescription"],"sources":["C:\\vivek\\Angular\\Stripe_demo\\src\\Pages\\payment\\payment.component.ts","C:\\vivek\\Angular\\Stripe_demo\\src\\Pages\\payment\\payment.component.html"],"sourcesContent":["import { Component } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { NgxSpinnerService } from 'ngx-spinner';\r\n\r\nimport { lastValueFrom } from 'rxjs';\r\nimport { StripeCustomer, subscription } from 'src/app/Model/payment/subscription';\r\nimport { CommonService } from 'src/app/Services/common/common.service';\r\nimport { PaymentService } from 'src/app/Services/payment/payment.service';\r\nimport { StorageKey, StorageService } from 'src/app/Services/storage/storage.service';\r\nimport { SubscriptionService } from 'src/app/Services/subscription/subscription.service';\r\nimport { ToastrMessageService } from 'src/app/Services/toastr-service/toastr-message.service';\r\nimport { environment, stripeConfig } from 'src/app/environments/environment';\r\n\r\ndeclare var Stripe: any;\r\n\r\nconst stripe = Stripe(stripeConfig.publishKey);\r\n\r\n@Component({\r\n  selector: 'app-payment',\r\n  templateUrl: './payment.component.html',\r\n  styleUrls: ['./payment.component.css']\r\n})\r\n\r\nexport class PaymentComponent {\r\n  PlanDetails: any = [];\r\n  planId: any;\r\n  customerId: any;\r\n  stripeCustomer: StripeCustomer | any;\r\n  subscriptionModel: subscription | undefined;\r\n  cardList: any = [];\r\n  showAddCard: boolean = true;\r\n  stripeCustomerId: any;\r\n  cardId: any;\r\n  baseURL: string = environment.BaseURL.replace(\"api/\", \"\");\r\n  todayDate: any = Date.now();\r\n  endDate: any;\r\n  cancaleDate: any;\r\n  PaymentSecrectKey: any;\r\n  isActive: boolean | undefined;\r\n\r\n  constructor(private toster: ToastrMessageService,\r\n    public commonService: CommonService,\r\n    private spinner: NgxSpinnerService,\r\n    private route: ActivatedRoute,\r\n    private paymentService: PaymentService,\r\n    private storage: StorageService,\r\n    private subscriptionService: SubscriptionService,\r\n    private router: Router\r\n  ) {\r\n\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.GetStripeDetailsById();\r\n    this.spinner.show();\r\n    this.planId = this.commonService.Decrypt(this.route.snapshot.paramMap.get('id') ?? \"\");\r\n    this.GetSubscriptionPLanById();\r\n  }\r\n\r\n  GetStripeDetailsById() {\r\n    this.spinner.show();\r\n    const userId = this.commonService.Decrypt(this.storage.getValue(StorageKey.currentUserId))\r\n    this.subscriptionService.getStripeDetailsById(userId).then((data: any) => {\r\n      if (data != null) {\r\n        this.stripeCustomerId = data.data.customerId;\r\n        this.endDate = data.data.endDate;\r\n        this.isActive = data.data.isActive;\r\n        this.cancaleDate = data.data.cancelDate;\r\n        if (this.stripeCustomerId == null) {\r\n          this.showAddCard = false;\r\n        }\r\n        this.GetSavedCardList();\r\n      }\r\n      else {\r\n      }\r\n    }).catch((error: any) => {\r\n      this.spinner.hide();\r\n    })\r\n  }\r\n\r\n  async LoadAndPay() {\r\n    const result = this.subscriptionService.InitiatePayment();\r\n    this.PaymentSecrectKey = await lastValueFrom(result);\r\n    var elements = new stripe.elements({\r\n      clientSecret: this.PaymentSecrectKey.data.clientSecret,\r\n      fonts: [\r\n        {\r\n          cssSrc: 'https://fonts.googleapis.com/css?family=Source+Code+Pro',\r\n        }\r\n      ]\r\n    });\r\n\r\n\r\n    var cardNumber = elements.create('cardNumber', {\r\n    });\r\n    cardNumber.mount('#card-number-element');\r\n    var cardExpiry = elements.create('cardExpiry', {\r\n    });\r\n    cardExpiry.mount('#card-cardExpiry-element');\r\n    var cardCvc = elements.create('cardCvc', {\r\n    });\r\n    cardCvc.mount('#card-cardCvc-element');\r\n\r\n    document.querySelector(\"#payment-form\")?.addEventListener(\"submit\", async (e) => {\r\n      e.preventDefault();\r\n      this.spinner.show();\r\n      stripe.handleCardSetup(\r\n        this.PaymentSecrectKey.data.clientSecret,\r\n        cardNumber\r\n      )\r\n      .then((result: any) => {\r\n        if (result.setupIntent != undefined && result.setupIntent.status == \"succeeded\") {\r\n          this.subscriptionModel = {\r\n            UserId: parseInt(this.commonService.Decrypt(this.storage.getValue('currentUserId'))),\r\n            PlanId: this.planId,\r\n            PaymentMethodId: result.setupIntent.payment_method,\r\n          }\r\n          if (this.stripeCustomerId == null || (!this.isActive && this.cancaleDate != null)) {\r\n            this.paymentService.InitializeCustomerSetupandSubscribe(this.subscriptionModel).then((data: any) => {\r\n              this.spinner.hide();\r\n              if (data.success) {\r\n                this.commonService.setData(true);\r\n                this.router.navigate([\"match\"]);\r\n                this.toster.success(\"You have successfully subscribed \" + this.PlanDetails.planName);\r\n                this.stripeCustomerId = data.data.customer;\r\n              }\r\n              else {\r\n                this.toster.error(data.message);\r\n              }\r\n            }).catch((error: any) => {\r\n              this.toster.error(error.error.message);\r\n              this.spinner.hide();\r\n            })\r\n          } else {\r\n            this.subscriptionService.UpgradeSubscription(this.subscriptionModel).then((data: any) => {\r\n              this.spinner.hide();\r\n              if (data && data.success) {\r\n                this.toster.success(data.message);\r\n                this.router.navigate([\"match\"]);\r\n              }\r\n              else {\r\n                this.toster.error(data.message);\r\n              }\r\n            }).catch((error) => {\r\n              this.toster.error(error.error.message);\r\n              this.spinner.hide();\r\n            })\r\n          }\r\n        }\r\n\r\n        else {\r\n          this.toster.error(result.error.message)\r\n          this.spinner.hide();\r\n        }\r\n      })\r\n    });\r\n  }\r\n\r\n  GetSubscriptionPLanById() {\r\n    this.paymentService.GetSubscriptionPlanById(this.planId).then((data: any) => {\r\n      this.spinner.hide();\r\n      if (data && data.success) {\r\n        this.PlanDetails = data.data;\r\n      }\r\n      else {\r\n        this.toster.error(data.message);\r\n      }\r\n    }).catch((error: any) => {\r\n      this.spinner.hide();\r\n      this.toster.error(error.error.message);\r\n    })\r\n\r\n  }\r\n\r\n  GetSavedCardList() {\r\n    this.customerId = this.commonService.Decrypt(this.storage.getValue('currentUserId'))\r\n    if (this.customerId != 'null') {\r\n      this.spinner.show();\r\n      this.subscriptionService.GetCardDetails(this.customerId).then((data: any) => {\r\n        this.spinner.hide();\r\n        if (data && data.success) {\r\n          this.cardList = data.data.data;\r\n        }\r\n        if (!this.showAddCard) {\r\n          this.LoadAndPay();\r\n        }\r\n      }).catch((error) => {\r\n        this.spinner.hide();\r\n      });\r\n    }\r\n  }\r\n\r\n  goToBack() {\r\n    this.router.navigate([\"subscription\"]);\r\n  }\r\n\r\n  showCardList() {\r\n    this.showAddCard = true;\r\n  }\r\n\r\n  showCard() {\r\n    this.cardId = null;\r\n    this.showAddCard = false;\r\n    setTimeout(() => {\r\n      this.LoadAndPay();\r\n    }, 0);\r\n\r\n  }\r\n  Addclass(id: any) {\r\n    this.cardId = id\r\n    document.querySelectorAll('.selected').forEach(e => {\r\n      e.classList.remove('selected');\r\n    });\r\n    document.getElementById(id)?.classList.add('selected');\r\n  }\r\n\r\n  pay() {\r\n    this.spinner.show();\r\n    this.subscriptionModel = {\r\n      UserId: parseInt(this.commonService.Decrypt(this.storage.getValue('currentUserId'))),\r\n      PlanId: this.planId,\r\n      PaymentMethodId: this.cardId,\r\n    }\r\n\r\n    if (this.cardId == null) {\r\n      this.toster.error(\"Please select card\");\r\n      this.spinner.hide();\r\n      return\r\n    }\r\n    if (this.stripeCustomerId == null || (!this.isActive && this.cancaleDate != null)) {\r\n      this.paymentService.InitializeCustomerSetupandSubscribe(this.subscriptionModel).then((data: any) => {\r\n        this.spinner.hide();\r\n        if (data && data.success) {\r\n          this.commonService.setData(true);\r\n          this.router.navigate([\"match\"]);\r\n          this.toster.success(\"You have successfully subscribed \" + this.PlanDetails.planName);\r\n        }\r\n        else {\r\n          this.toster.error(data.message);\r\n        }\r\n      }).catch((error: any) => {\r\n        this.toster.error(error.error.message);\r\n        this.spinner.hide();\r\n      })\r\n    }\r\n    else {\r\n      this.subscriptionService.UpgradeSubscription(this.subscriptionModel).then((data: any) => {\r\n        this.spinner.hide();\r\n        if (data && data.success) {\r\n          this.toster.success(data.message);\r\n          this.router.navigate([\"match\"]);\r\n        }\r\n        else {\r\n          this.toster.error(data.message);\r\n        }\r\n      }).catch((error) => {\r\n        this.toster.error(error.error.message);\r\n        this.spinner.hide();\r\n      })\r\n    }\r\n  }\r\n}","<div class=\"main-innerpage w-100 float-start\">\r\n    <div class=\"container\">\r\n        <div class=\"innerpages\">\r\n            <h2>Proceed to payment</h2>\r\n            <span>Home &gt; <span class=\"font-color-pink\">Proceed to payment</span></span>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class=\"w-100 float-start payment_main\">\r\n    <div class=\"container\">\r\n        <div class=\"payment_main_inner\">\r\n            <div class=\"plan_section\">\r\n                <div class=\"header\">\r\n                    <a class=\"header_link\" (click)=\"goToBack()\">\r\n                        <svg class=\"icon\" focusable=\"false\" width=\"12\" height=\"12\" viewBox=\"0 0 16 16\">\r\n                            <path\r\n                                d=\"M3.417 7H15a1 1 0 0 1 0 2H3.417l4.591 4.591a1 1 0 0 1-1.415 1.416l-6.3-6.3a1 1 0 0 1 0-1.414l6.3-6.3A1 1 0 0 1 8.008 2.41z\"\r\n                                fill-rule=\"evenodd\"></path>\r\n                        </svg>\r\n                    </a>\r\n                </div>\r\n                <div class=\"plan_summry\">\r\n                    <h5>{{this.PlanDetails.planName}}</h5>\r\n                    <div class=\"plan_inner\">\r\n                        <label>{{this.PlanDetails.charges}}<span>per<br>{{this.PlanDetails.intervalCount}}\r\n                                {{this.PlanDetails.interval}}</span></label>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"plan_list\">\r\n                    <div class=\"selected_plan\">\r\n                        <img src=\"../assets/images/Logo-Dating.png\" class=\"logo\">\r\n                        <div class=\"text\">\r\n                            <div class=\"plan_name\">\r\n                                <label>{{this.PlanDetails.planName}} <span class=\"badge\"></span></label>\r\n                                <label class=\"small\">{{this.PlanDetails.planDescription}}</label>\r\n                            </div>\r\n                            <div>\r\n                                <h6 class=\"price\">{{this.PlanDetails.charges}}</h6>\r\n\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"stripe_section\">\r\n                <div *ngIf=\"stripeCustomerId != null\">\r\n                    <div class=\"text-center\">\r\n                        <button *ngIf=\"!showAddCard\" class=\"main-btn add_card_btn text-center\" title=\"Make Payment\"\r\n                            (click)=\"showCardList()\">\r\n                            Pay with existing card\r\n                        </button>\r\n                    </div>\r\n                    <div *ngIf=\"showAddCard\" class=\"w-100\">\r\n                        <ul class=\"card_list mt-3\" *ngFor=\"let item of cardList\">\r\n                            <li id={{item.id}} (click)=\"Addclass(item.id)\">\r\n                                <a href=\"javascript:;\">\r\n                                    <div class=\"row card_details_main\">\r\n                                        <div class=\"card_details\">\r\n                                            <img class=\"img-fluid\" src=\"{{baseURL}}{{item.card.cardLogo}}\" />\r\n                                            <input disabled type=\"text\"\r\n                                                placeholder=\"**** **** **** {{item.card.last4}}\">\r\n                                        </div>\r\n                                    </div>\r\n                                </a>\r\n                            </li>\r\n                        </ul>\r\n                        <button type=\"submit\" (click)=\"pay()\" class=\"payment-submit\">Pay</button>\r\n                    </div>\r\n                    <p class=\"or_devider\">OR</p>\r\n                    <div class=\"add_card_main text-center\">\r\n                        <button *ngIf=\"showAddCard\" class=\"main-btn add_card_btn text-center\" title=\"Add New Card\"\r\n                            (click)=\"showCard()\">\r\n                            Pay with new card\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                <div *ngIf=\"!showAddCard\" class=\"formdata mt-3 w-100\">\r\n                    <form id=\"payment-form\" class=\"mt-5\">\r\n                        <!-- <form id=\"stripe-card-form\"> -->\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-12 mb-2\">\r\n                                <div id=\"card-number-element\" class=\"form-control\"></div>\r\n                            </div>\r\n                            <div class=\"col-md-6 mb-2\">\r\n                                <div id=\"card-cardExpiry-element\" class=\"form-control\"></div>\r\n                            </div>\r\n                            <div class=\"col-md-6 mb-2\">\r\n                                <div id=\"card-cardCvc-element\" class=\"form-control\"></div>\r\n                            </div>\r\n                            <div class=\"col-md-12 mb-2\">\r\n                                <div id=\"card-zip-element\" class=\"form-control\">\r\n                                    <input type=\"number\" placeholder=\"12345\" maxlength=\"5\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                        </div>\r\n\r\n                        <!-- </form> -->\r\n                        <div id=\"error-messages\"></div>\r\n                        <div id=\"pay-button\"></div>\r\n                        <button type=\"submit\" id=\"btnSubmit\" class=\"payment-submit\">Pay</button>\r\n\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}