{"ast":null,"code":"import _asyncToGenerator from \"C:/vivek/Angular/Stripe_demo/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { lastValueFrom } from 'rxjs';\nimport { StorageKey } from 'src/app/Services/storage/storage.service';\nimport { environment, stripeConfig } from 'src/app/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/Services/common/common.service\";\nimport * as i2 from \"ngx-spinner\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"src/app/Services/payment/payment.service\";\nimport * as i5 from \"src/app/Services/storage/storage.service\";\nimport * as i6 from \"src/app/Services/subscription/subscription.service\";\nimport * as i7 from \"@angular/common\";\nfunction AppComponent_div_41_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 30);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_41_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.showCardList());\n    });\n    i0.ɵɵtext(1, \" Pay with existing card \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_41_div_3_ul_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ul\", 34)(1, \"li\", 35);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_41_div_3_ul_1_Template_li_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const item_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r9.Addclass(item_r8.id));\n    });\n    i0.ɵɵelementStart(2, \"a\", 36)(3, \"div\", 37)(4, \"div\", 38);\n    i0.ɵɵelement(5, \"img\", 39)(6, \"input\", 40);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const item_r8 = ctx.$implicit;\n    const ctx_r7 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"id\", item_r8.id);\n    i0.ɵɵadvance(4);\n    i0.ɵɵpropertyInterpolate2(\"src\", \"\", ctx_r7.baseURL, \"\", item_r8.card.cardLogo, \"\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate1(\"placeholder\", \"**** **** **** \", item_r8.card.last4, \"\");\n  }\n}\nfunction AppComponent_div_41_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 31);\n    i0.ɵɵtemplate(1, AppComponent_div_41_div_3_ul_1_Template, 7, 4, \"ul\", 32);\n    i0.ɵɵelementStart(2, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_41_div_3_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.pay());\n    });\n    i0.ɵɵtext(3, \"Pay\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.cardList);\n  }\n}\nfunction AppComponent_div_41_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 41);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_41_button_7_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r13.showCard());\n    });\n    i0.ɵɵtext(1, \" Pay with new card \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 24);\n    i0.ɵɵtemplate(2, AppComponent_div_41_button_2_Template, 2, 0, \"button\", 25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, AppComponent_div_41_div_3_Template, 4, 1, \"div\", 26);\n    i0.ɵɵelementStart(4, \"p\", 27);\n    i0.ɵɵtext(5, \"OR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 28);\n    i0.ɵɵtemplate(7, AppComponent_div_41_button_7_Template, 2, 0, \"button\", 29);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.showAddCard);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showAddCard);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showAddCard);\n  }\n}\nfunction AppComponent_div_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"form\", 43)(2, \"div\", 44)(3, \"div\", 45);\n    i0.ɵɵelement(4, \"div\", 46);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 47);\n    i0.ɵɵelement(6, \"div\", 48);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 47);\n    i0.ɵɵelement(8, \"div\", 49);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 45)(10, \"div\", 50);\n    i0.ɵɵelement(11, \"input\", 51);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(12, \"div\", 52)(13, \"div\", 53);\n    i0.ɵɵelementStart(14, \"button\", 54);\n    i0.ɵɵtext(15, \"Pay\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nconst stripe = Stripe(stripeConfig.publishKey);\nclass AppComponent {\n  constructor(commonService, spinner, route, paymentService, storage, subscriptionService, router) {\n    this.commonService = commonService;\n    this.spinner = spinner;\n    this.route = route;\n    this.paymentService = paymentService;\n    this.storage = storage;\n    this.subscriptionService = subscriptionService;\n    this.router = router;\n    this.PlanDetails = [];\n    this.cardList = [];\n    this.showAddCard = true;\n    this.baseURL = environment.BaseURL.replace(\"api/\", \"\");\n    this.todayDate = Date.now();\n  }\n  ngOnInit() {\n    this.GetStripeDetailsById();\n    this.spinner.show();\n    this.planId = this.commonService.Decrypt(this.route.snapshot.paramMap.get('id') ?? \"\");\n    this.GetSubscriptionPLanById();\n  }\n  GetStripeDetailsById() {\n    this.spinner.show();\n    const userId = this.commonService.Decrypt(this.storage.getValue(StorageKey.currentUserId));\n    this.subscriptionService.getStripeDetailsById(userId).then(data => {\n      if (data != null) {\n        this.stripeCustomerId = data.data.customerId;\n        this.endDate = data.data.endDate;\n        this.isActive = data.data.isActive;\n        this.cancaleDate = data.data.cancelDate;\n        if (this.stripeCustomerId == null) {\n          this.showAddCard = false;\n        }\n        this.GetSavedCardList();\n      } else {}\n    }).catch(error => {\n      this.spinner.hide();\n    });\n  }\n  LoadAndPay() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const result = _this.subscriptionService.InitiatePayment();\n      _this.PaymentSecrectKey = yield lastValueFrom(result);\n      var elements = new stripe.elements({\n        clientSecret: _this.PaymentSecrectKey.data.clientSecret,\n        fonts: [{\n          cssSrc: 'https://fonts.googleapis.com/css?family=Source+Code+Pro'\n        }]\n      });\n      var cardNumber = elements.create('cardNumber', {});\n      cardNumber.mount('#card-number-element');\n      var cardExpiry = elements.create('cardExpiry', {});\n      cardExpiry.mount('#card-cardExpiry-element');\n      var cardCvc = elements.create('cardCvc', {});\n      cardCvc.mount('#card-cardCvc-element');\n      document.querySelector(\"#payment-form\")?.addEventListener(\"submit\", /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (e) {\n          e.preventDefault();\n          _this.spinner.show();\n          stripe.handleCardSetup(_this.PaymentSecrectKey.data.clientSecret, cardNumber).then(result => {\n            if (result.setupIntent != undefined && result.setupIntent.status == \"succeeded\") {\n              _this.subscriptionModel = {\n                UserId: parseInt(_this.commonService.Decrypt(_this.storage.getValue('currentUserId'))),\n                PlanId: _this.planId,\n                PaymentMethodId: result.setupIntent.payment_method\n              };\n              if (_this.stripeCustomerId == null || !_this.isActive && _this.cancaleDate != null) {\n                _this.paymentService.InitializeCustomerSetupandSubscribe(_this.subscriptionModel).then(data => {\n                  _this.spinner.hide();\n                  if (data.success) {\n                    _this.commonService.setData(true);\n                    _this.router.navigate([\"match\"]);\n                    _this.stripeCustomerId = data.data.customer;\n                  } else {}\n                }).catch(error => {\n                  _this.spinner.hide();\n                });\n              } else {\n                _this.subscriptionService.UpgradeSubscription(_this.subscriptionModel).then(data => {\n                  _this.spinner.hide();\n                  if (data && data.success) {\n                    _this.router.navigate([\"match\"]);\n                  } else {}\n                }).catch(error => {\n                  _this.spinner.hide();\n                });\n              }\n            } else {\n              _this.spinner.hide();\n            }\n          });\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n  GetSubscriptionPLanById() {\n    this.paymentService.GetSubscriptionPlanById(this.planId).then(data => {\n      this.spinner.hide();\n      if (data && data.success) {\n        this.PlanDetails = data.data;\n      } else {}\n    }).catch(error => {\n      this.spinner.hide();\n    });\n  }\n  GetSavedCardList() {\n    this.customerId = this.commonService.Decrypt(this.storage.getValue('currentUserId'));\n    if (this.customerId != 'null') {\n      this.spinner.show();\n      this.subscriptionService.GetCardDetails(this.customerId).then(data => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.cardList = data.data.data;\n        }\n        if (!this.showAddCard) {\n          this.LoadAndPay();\n        }\n      }).catch(error => {\n        this.spinner.hide();\n      });\n    }\n  }\n  goToBack() {\n    this.router.navigate([\"subscription\"]);\n  }\n  showCardList() {\n    this.showAddCard = true;\n  }\n  showCard() {\n    this.cardId = null;\n    this.showAddCard = false;\n    setTimeout(() => {\n      this.LoadAndPay();\n    }, 0);\n  }\n  Addclass(id) {\n    this.cardId = id;\n    document.querySelectorAll('.selected').forEach(e => {\n      e.classList.remove('selected');\n    });\n    document.getElementById(id)?.classList.add('selected');\n  }\n  pay() {\n    this.spinner.show();\n    this.subscriptionModel = {\n      UserId: parseInt(this.commonService.Decrypt(this.storage.getValue('currentUserId'))),\n      PlanId: this.planId,\n      PaymentMethodId: this.cardId\n    };\n    if (this.cardId == null) {\n      this.spinner.hide();\n      return;\n    }\n    if (this.stripeCustomerId == null || !this.isActive && this.cancaleDate != null) {\n      this.paymentService.InitializeCustomerSetupandSubscribe(this.subscriptionModel).then(data => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.commonService.setData(true);\n          this.router.navigate([\"match\"]);\n        } else {}\n      }).catch(error => {\n        this.spinner.hide();\n      });\n    } else {\n      this.subscriptionService.UpgradeSubscription(this.subscriptionModel).then(data => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.router.navigate([\"match\"]);\n        } else {}\n      }).catch(error => {\n        this.spinner.hide();\n      });\n    }\n  }\n  static #_ = this.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.CommonService), i0.ɵɵdirectiveInject(i2.NgxSpinnerService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i4.PaymentService), i0.ɵɵdirectiveInject(i5.StorageService), i0.ɵɵdirectiveInject(i6.SubscriptionService), i0.ɵɵdirectiveInject(i3.Router));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"app-root\"]],\n    decls: 44,\n    vars: 9,\n    consts: [[1, \"main-innerpage\", \"w-100\", \"float-start\", \"mt-5\"], [1, \"container\"], [1, \"innerpages\"], [1, \"font-color-pink\"], [1, \"w-100\", \"float-start\", \"payment_main\"], [1, \"payment_main_inner\"], [1, \"plan_section\"], [1, \"header\"], [1, \"header_link\", 3, \"click\"], [\"focusable\", \"false\", \"width\", \"12\", \"height\", \"12\", \"viewBox\", \"0 0 16 16\", 1, \"icon\"], [\"d\", \"M3.417 7H15a1 1 0 0 1 0 2H3.417l4.591 4.591a1 1 0 0 1-1.415 1.416l-6.3-6.3a1 1 0 0 1 0-1.414l6.3-6.3A1 1 0 0 1 8.008 2.41z\", \"fill-rule\", \"evenodd\"], [1, \"plan_summry\"], [1, \"plan_inner\"], [1, \"plan_list\"], [1, \"selected_plan\"], [\"src\", \"../assets/images/Logo-Dating.png\", 1, \"logo\"], [1, \"text\"], [1, \"plan_name\"], [1, \"badge\"], [1, \"small\"], [1, \"price\"], [1, \"stripe_section\"], [4, \"ngIf\"], [\"class\", \"formdata mt-3 w-100\", 4, \"ngIf\"], [1, \"text-center\"], [\"class\", \"main-btn add_card_btn text-center\", \"title\", \"Make Payment\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"w-100\", 4, \"ngIf\"], [1, \"or_devider\"], [1, \"add_card_main\", \"text-center\"], [\"class\", \"main-btn add_card_btn text-center\", \"title\", \"Add New Card\", 3, \"click\", 4, \"ngIf\"], [\"title\", \"Make Payment\", 1, \"main-btn\", \"add_card_btn\", \"text-center\", 3, \"click\"], [1, \"w-100\"], [\"class\", \"card_list mt-3\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"payment-submit\", 3, \"click\"], [1, \"card_list\", \"mt-3\"], [3, \"id\", \"click\"], [\"href\", \"javascript:;\"], [1, \"row\", \"card_details_main\"], [1, \"card_details\"], [1, \"img-fluid\", 3, \"src\"], [\"disabled\", \"\", \"type\", \"text\", 3, \"placeholder\"], [\"title\", \"Add New Card\", 1, \"main-btn\", \"add_card_btn\", \"text-center\", 3, \"click\"], [1, \"formdata\", \"mt-3\", \"w-100\"], [\"id\", \"payment-form\", 1, \"mt-5\"], [1, \"row\"], [1, \"col-md-12\", \"mb-2\"], [\"id\", \"card-number-element\", 1, \"form-control\"], [1, \"col-md-6\", \"mb-2\"], [\"id\", \"card-cardExpiry-element\", 1, \"form-control\"], [\"id\", \"card-cardCvc-element\", 1, \"form-control\"], [\"id\", \"card-zip-element\", 1, \"form-control\"], [\"type\", \"number\", \"placeholder\", \"12345\", \"maxlength\", \"5\"], [\"id\", \"error-messages\"], [\"id\", \"pay-button\"], [\"type\", \"submit\", \"id\", \"btnSubmit\", 1, \"payment-submit\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h2\");\n        i0.ɵɵtext(4, \"Proceed to payment\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"span\");\n        i0.ɵɵtext(6, \"Home > \");\n        i0.ɵɵelementStart(7, \"span\", 3);\n        i0.ɵɵtext(8, \"Proceed to payment\");\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(9, \"div\", 4)(10, \"div\", 1)(11, \"div\", 5)(12, \"div\", 6)(13, \"div\", 7)(14, \"a\", 8);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_a_click_14_listener() {\n          return ctx.goToBack();\n        });\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(15, \"svg\", 9);\n        i0.ɵɵelement(16, \"path\", 10);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelementStart(17, \"div\", 11)(18, \"h5\");\n        i0.ɵɵtext(19);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"div\", 12)(21, \"label\");\n        i0.ɵɵtext(22);\n        i0.ɵɵelementStart(23, \"span\");\n        i0.ɵɵtext(24, \"per\");\n        i0.ɵɵelement(25, \"br\");\n        i0.ɵɵtext(26);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(27, \"div\", 13)(28, \"div\", 14);\n        i0.ɵɵelement(29, \"img\", 15);\n        i0.ɵɵelementStart(30, \"div\", 16)(31, \"div\", 17)(32, \"label\");\n        i0.ɵɵtext(33);\n        i0.ɵɵelement(34, \"span\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"label\", 19);\n        i0.ɵɵtext(36);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(37, \"div\")(38, \"h6\", 20);\n        i0.ɵɵtext(39);\n        i0.ɵɵelementEnd()()()()()();\n        i0.ɵɵelementStart(40, \"div\", 21);\n        i0.ɵɵtemplate(41, AppComponent_div_41_Template, 8, 3, \"div\", 22);\n        i0.ɵɵtemplate(42, AppComponent_div_42_Template, 16, 0, \"div\", 23);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelement(43, \"router-outlet\");\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(19);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.planName);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.charges);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate2(\"\", ctx.PlanDetails.intervalCount, \" \", ctx.PlanDetails.interval, \"\");\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate1(\"\", ctx.PlanDetails.planName, \" \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.planDescription);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.PlanDetails.charges);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.stripeCustomerId != null);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.showAddCard);\n      }\n    },\n    dependencies: [i7.NgForOf, i7.NgIf, i3.RouterOutlet],\n    styles: [\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}\nexport { AppComponent };","map":{"version":3,"names":["lastValueFrom","StorageKey","environment","stripeConfig","i0","ɵɵelementStart","ɵɵlistener","AppComponent_div_41_button_2_Template_button_click_0_listener","ɵɵrestoreView","_r6","ctx_r5","ɵɵnextContext","ɵɵresetView","showCardList","ɵɵtext","ɵɵelementEnd","AppComponent_div_41_div_3_ul_1_Template_li_click_1_listener","restoredCtx","_r10","item_r8","$implicit","ctx_r9","Addclass","id","ɵɵelement","ɵɵadvance","ɵɵpropertyInterpolate","ɵɵpropertyInterpolate2","ctx_r7","baseURL","card","cardLogo","ɵɵsanitizeUrl","ɵɵpropertyInterpolate1","last4","ɵɵtemplate","AppComponent_div_41_div_3_ul_1_Template","AppComponent_div_41_div_3_Template_button_click_2_listener","_r12","ctx_r11","pay","ɵɵproperty","ctx_r3","cardList","AppComponent_div_41_button_7_Template_button_click_0_listener","_r14","ctx_r13","showCard","AppComponent_div_41_button_2_Template","AppComponent_div_41_div_3_Template","AppComponent_div_41_button_7_Template","ctx_r0","showAddCard","stripe","Stripe","publishKey","AppComponent","constructor","commonService","spinner","route","paymentService","storage","subscriptionService","router","PlanDetails","BaseURL","replace","todayDate","Date","now","ngOnInit","GetStripeDetailsById","show","planId","Decrypt","snapshot","paramMap","get","GetSubscriptionPLanById","userId","getValue","currentUserId","getStripeDetailsById","then","data","stripeCustomerId","customerId","endDate","isActive","cancaleDate","cancelDate","GetSavedCardList","catch","error","hide","LoadAndPay","_this","_asyncToGenerator","result","InitiatePayment","PaymentSecrectKey","elements","clientSecret","fonts","cssSrc","cardNumber","create","mount","cardExpiry","cardCvc","document","querySelector","addEventListener","_ref","e","preventDefault","handleCardSetup","setupIntent","undefined","status","subscriptionModel","UserId","parseInt","PlanId","PaymentMethodId","payment_method","InitializeCustomerSetupandSubscribe","success","setData","navigate","customer","UpgradeSubscription","_x","apply","arguments","GetSubscriptionPlanById","GetCardDetails","goToBack","cardId","setTimeout","querySelectorAll","forEach","classList","remove","getElementById","add","_","ɵɵdirectiveInject","i1","CommonService","i2","NgxSpinnerService","i3","ActivatedRoute","i4","PaymentService","i5","StorageService","i6","SubscriptionService","Router","_2","selectors","decls","vars","consts","template","AppComponent_Template","rf","ctx","AppComponent_Template_a_click_14_listener","ɵɵnamespaceSVG","ɵɵnamespaceHTML","AppComponent_div_41_Template","AppComponent_div_42_Template","ɵɵtextInterpolate","planName","charges","ɵɵtextInterpolate2","intervalCount","interval","ɵɵtextInterpolate1","planDescription"],"sources":["C:\\vivek\\Angular\\Stripe_demo\\src\\app\\app.component.ts","C:\\vivek\\Angular\\Stripe_demo\\src\\app\\app.component.html"],"sourcesContent":["\n\nimport { Component } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { NgxSpinnerService } from 'ngx-spinner';\n\nimport { lastValueFrom } from 'rxjs';\nimport { StripeCustomer, subscription } from 'src/app/Model/payment/subscription';\nimport { CommonService } from 'src/app/Services/common/common.service';\nimport { PaymentService } from 'src/app/Services/payment/payment.service';\nimport { StorageKey, StorageService } from 'src/app/Services/storage/storage.service';\nimport { SubscriptionService } from 'src/app/Services/subscription/subscription.service';\nimport { environment, stripeConfig } from 'src/app/environments/environment';\n\ndeclare var Stripe: any;\n\nconst stripe = Stripe(stripeConfig.publishKey);\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\n\nexport class AppComponent {\n  PlanDetails: any = [];\n  planId: any;\n  customerId: any;\n  stripeCustomer: StripeCustomer | any;\n  subscriptionModel: subscription | undefined;\n  cardList: any = [];\n  showAddCard: boolean = true;\n  stripeCustomerId: any;\n  cardId: any;\n  baseURL: string = environment.BaseURL.replace(\"api/\", \"\");\n  todayDate: any = Date.now();\n  endDate: any;\n  cancaleDate: any;\n  PaymentSecrectKey: any;\n  isActive: boolean | undefined;\n\n  constructor(\n    public commonService: CommonService,\n    private spinner: NgxSpinnerService,\n    private route: ActivatedRoute,\n    private paymentService: PaymentService,\n    private storage: StorageService,\n    private subscriptionService: SubscriptionService,\n    private router: Router\n  ) {\n\n  }\n\n  ngOnInit(): void {\n    this.GetStripeDetailsById();\n    this.spinner.show();\n    this.planId = this.commonService.Decrypt(this.route.snapshot.paramMap.get('id') ?? \"\");\n    this.GetSubscriptionPLanById();\n  }\n\n  GetStripeDetailsById() {\n    this.spinner.show();\n    const userId = this.commonService.Decrypt(this.storage.getValue(StorageKey.currentUserId))\n    this.subscriptionService.getStripeDetailsById(userId).then((data: any) => {\n      if (data != null) {\n        this.stripeCustomerId = data.data.customerId;\n        this.endDate = data.data.endDate;\n        this.isActive = data.data.isActive;\n        this.cancaleDate = data.data.cancelDate;\n        if (this.stripeCustomerId == null) {\n          this.showAddCard = false;\n        }\n        this.GetSavedCardList();\n      }\n      else {\n      }\n    }).catch((error: any) => {\n      this.spinner.hide();\n    })\n  }\n\n  async LoadAndPay() {\n    const result = this.subscriptionService.InitiatePayment();\n    this.PaymentSecrectKey = await lastValueFrom(result);\n    var elements = new stripe.elements({\n      clientSecret: this.PaymentSecrectKey.data.clientSecret,\n      fonts: [\n        {\n          cssSrc: 'https://fonts.googleapis.com/css?family=Source+Code+Pro',\n        }\n      ]\n    });\n\n\n    var cardNumber = elements.create('cardNumber', {\n    });\n    cardNumber.mount('#card-number-element');\n    var cardExpiry = elements.create('cardExpiry', {\n    });\n    cardExpiry.mount('#card-cardExpiry-element');\n    var cardCvc = elements.create('cardCvc', {\n    });\n    cardCvc.mount('#card-cardCvc-element');\n\n    document.querySelector(\"#payment-form\")?.addEventListener(\"submit\", async (e) => {\n      e.preventDefault();\n      this.spinner.show();\n      stripe.handleCardSetup(\n        this.PaymentSecrectKey.data.clientSecret,\n        cardNumber\n      )\n      .then((result: any) => {\n        if (result.setupIntent != undefined && result.setupIntent.status == \"succeeded\") {\n          this.subscriptionModel = {\n            UserId: parseInt(this.commonService.Decrypt(this.storage.getValue('currentUserId'))),\n            PlanId: this.planId,\n            PaymentMethodId: result.setupIntent.payment_method,\n          }\n          if (this.stripeCustomerId == null || (!this.isActive && this.cancaleDate != null)) {\n            this.paymentService.InitializeCustomerSetupandSubscribe(this.subscriptionModel).then((data: any) => {\n              this.spinner.hide();\n              if (data.success) {\n                this.commonService.setData(true);\n                this.router.navigate([\"match\"]);\n              \n                this.stripeCustomerId = data.data.customer;\n              }\n              else {\n    \n              }\n            }).catch((error: any) => {\n          \n              this.spinner.hide();\n            })\n          } else {\n            this.subscriptionService.UpgradeSubscription(this.subscriptionModel).then((data: any) => {\n              this.spinner.hide();\n              if (data && data.success) {\n          \n                this.router.navigate([\"match\"]);\n              }\n              else {\n          \n              }\n            }).catch((error) => {\n          \n              this.spinner.hide();\n            })\n          }\n        }\n\n        else {\n   \n          this.spinner.hide();\n        }\n      })\n    });\n  }\n\n  GetSubscriptionPLanById() {\n    this.paymentService.GetSubscriptionPlanById(this.planId).then((data: any) => {\n      this.spinner.hide();\n      if (data && data.success) {\n        this.PlanDetails = data.data;\n      }\n      else {\n    \n      }\n    }).catch((error: any) => {\n      this.spinner.hide();\n     \n    })\n\n  }\n\n  GetSavedCardList() {\n    this.customerId = this.commonService.Decrypt(this.storage.getValue('currentUserId'))\n    if (this.customerId != 'null') {\n      this.spinner.show();\n      this.subscriptionService.GetCardDetails(this.customerId).then((data: any) => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.cardList = data.data.data;\n        }\n        if (!this.showAddCard) {\n          this.LoadAndPay();\n        }\n      }).catch((error) => {\n        this.spinner.hide();\n      });\n    }\n  }\n\n  goToBack() {\n    this.router.navigate([\"subscription\"]);\n  }\n\n  showCardList() {\n    this.showAddCard = true;\n  }\n\n  showCard() {\n    this.cardId = null;\n    this.showAddCard = false;\n    setTimeout(() => {\n      this.LoadAndPay();\n    }, 0);\n\n  }\n  Addclass(id: any) {\n    this.cardId = id\n    document.querySelectorAll('.selected').forEach(e => {\n      e.classList.remove('selected');\n    });\n    document.getElementById(id)?.classList.add('selected');\n  }\n\n  pay() {\n    this.spinner.show();\n    this.subscriptionModel = {\n      UserId: parseInt(this.commonService.Decrypt(this.storage.getValue('currentUserId'))),\n      PlanId: this.planId,\n      PaymentMethodId: this.cardId,\n    }\n\n    if (this.cardId == null) {\n  \n      this.spinner.hide();\n      return\n    }\n    if (this.stripeCustomerId == null || (!this.isActive && this.cancaleDate != null)) {\n      this.paymentService.InitializeCustomerSetupandSubscribe(this.subscriptionModel).then((data: any) => {\n        this.spinner.hide();\n        if (data && data.success) {\n          this.commonService.setData(true);\n          this.router.navigate([\"match\"]);\n     \n        }\n        else {\n         \n        }\n      }).catch((error: any) => {\n   \n        this.spinner.hide();\n      })\n    }\n    else {\n      this.subscriptionService.UpgradeSubscription(this.subscriptionModel).then((data: any) => {\n        this.spinner.hide();\n        if (data && data.success) {\n       \n          this.router.navigate([\"match\"]);\n        }\n        else {\n      \n        }\n      }).catch((error) => {\n\n        this.spinner.hide();\n      })\n    }\n  }\n}","<div class=\"main-innerpage w-100 float-start mt-5\">\n  <div class=\"container\">\n      <div class=\"innerpages\">\n          <h2>Proceed to payment</h2>\n          <span>Home &gt; <span class=\"font-color-pink\">Proceed to payment</span></span>\n      </div>\n  </div>\n</div>\n<div class=\"w-100 float-start payment_main\">\n  <div class=\"container\">\n      <div class=\"payment_main_inner\">\n          <div class=\"plan_section\">\n              <div class=\"header\">\n                  <a class=\"header_link\" (click)=\"goToBack()\">\n                      <svg class=\"icon\" focusable=\"false\" width=\"12\" height=\"12\" viewBox=\"0 0 16 16\">\n                          <path\n                              d=\"M3.417 7H15a1 1 0 0 1 0 2H3.417l4.591 4.591a1 1 0 0 1-1.415 1.416l-6.3-6.3a1 1 0 0 1 0-1.414l6.3-6.3A1 1 0 0 1 8.008 2.41z\"\n                              fill-rule=\"evenodd\"></path>\n                      </svg>\n                  </a>\n              </div>\n              <div class=\"plan_summry\">\n                  <h5>{{this.PlanDetails.planName}}</h5>\n                  <div class=\"plan_inner\">\n                      <label>{{this.PlanDetails.charges}}<span>per<br>{{this.PlanDetails.intervalCount}}\n                              {{this.PlanDetails.interval}}</span></label>\n                  </div>\n              </div>\n\n              <div class=\"plan_list\">\n                  <div class=\"selected_plan\">\n                      <img src=\"../assets/images/Logo-Dating.png\" class=\"logo\">\n                      <div class=\"text\">\n                          <div class=\"plan_name\">\n                              <label>{{this.PlanDetails.planName}} <span class=\"badge\"></span></label>\n                              <label class=\"small\">{{this.PlanDetails.planDescription}}</label>\n                          </div>\n                          <div>\n                              <h6 class=\"price\">{{this.PlanDetails.charges}}</h6>\n\n                          </div>\n                      </div>\n                  </div>\n              </div>\n          </div>\n          <div class=\"stripe_section\">\n              <div *ngIf=\"stripeCustomerId != null\">\n                  <div class=\"text-center\">\n                      <button *ngIf=\"!showAddCard\" class=\"main-btn add_card_btn text-center\" title=\"Make Payment\"\n                          (click)=\"showCardList()\">\n                          Pay with existing card\n                      </button>\n                  </div>\n                  <div *ngIf=\"showAddCard\" class=\"w-100\">\n                      <ul class=\"card_list mt-3\" *ngFor=\"let item of cardList\">\n                          <li id={{item.id}} (click)=\"Addclass(item.id)\">\n                              <a href=\"javascript:;\">\n                                  <div class=\"row card_details_main\">\n                                      <div class=\"card_details\">\n                                          <img class=\"img-fluid\" src=\"{{baseURL}}{{item.card.cardLogo}}\" />\n                                          <input disabled type=\"text\"\n                                              placeholder=\"**** **** **** {{item.card.last4}}\">\n                                      </div>\n                                  </div>\n                              </a>\n                          </li>\n                      </ul>\n                      <button type=\"submit\" (click)=\"pay()\" class=\"payment-submit\">Pay</button>\n                  </div>\n                  <p class=\"or_devider\">OR</p>\n                  <div class=\"add_card_main text-center\">\n                      <button *ngIf=\"showAddCard\" class=\"main-btn add_card_btn text-center\" title=\"Add New Card\"\n                          (click)=\"showCard()\">\n                          Pay with new card\n                      </button>\n                  </div>\n              </div>\n              <div *ngIf=\"!showAddCard\" class=\"formdata mt-3 w-100\">\n                  <form id=\"payment-form\" class=\"mt-5\">\n                      <!-- <form id=\"stripe-card-form\"> -->\n                      <div class=\"row\">\n                          <div class=\"col-md-12 mb-2\">\n                              <div id=\"card-number-element\" class=\"form-control\"></div>\n                          </div>\n                          <div class=\"col-md-6 mb-2\">\n                              <div id=\"card-cardExpiry-element\" class=\"form-control\"></div>\n                          </div>\n                          <div class=\"col-md-6 mb-2\">\n                              <div id=\"card-cardCvc-element\" class=\"form-control\"></div>\n                          </div>\n                          <div class=\"col-md-12 mb-2\">\n                              <div id=\"card-zip-element\" class=\"form-control\">\n                                  <input type=\"number\" placeholder=\"12345\" maxlength=\"5\" />\n                              </div>\n                          </div>\n\n                      </div>\n\n                      <!-- </form> -->\n                      <div id=\"error-messages\"></div>\n                      <div id=\"pay-button\"></div>\n                      <button type=\"submit\" id=\"btnSubmit\" class=\"payment-submit\">Pay</button>\n\n                  </form>\n              </div>\n          </div>\n      </div>\n  </div>\n</div>\n<router-outlet></router-outlet>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}